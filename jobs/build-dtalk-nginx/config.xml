<?xml version='1.0' encoding='UTF-8'?>
<project>
  <actions/>
  <description></description>
  <keepDependencies>false</keepDependencies>
  <properties>
    <jenkins.model.BuildDiscarderProperty>
      <strategy class="hudson.tasks.LogRotator">
        <daysToKeep>-1</daysToKeep>
        <numToKeep>2</numToKeep>
        <artifactDaysToKeep>-1</artifactDaysToKeep>
        <artifactNumToKeep>-1</artifactNumToKeep>
      </strategy>
    </jenkins.model.BuildDiscarderProperty>
  </properties>
  <scm class="hudson.plugins.git.GitSCM" plugin="git@3.0.1">
    <configVersion>2</configVersion>
    <userRemoteConfigs>
      <hudson.plugins.git.UserRemoteConfig>
        <url>ssh://ec2-50-19-97-148.compute-1.amazonaws.com/symphony/product/web-portal.git</url>
        <credentialsId>af3778d0-f05c-4608-878e-c085228d6b05</credentialsId>
      </hudson.plugins.git.UserRemoteConfig>
    </userRemoteConfigs>
    <branches>
      <hudson.plugins.git.BranchSpec>
        <name>*/dtalk-develop</name>
      </hudson.plugins.git.BranchSpec>
    </branches>
    <doGenerateSubmoduleConfigurations>false</doGenerateSubmoduleConfigurations>
    <submoduleCfg class="list"/>
    <extensions>
      <hudson.plugins.git.extensions.impl.RelativeTargetDirectory>
        <relativeTargetDir>app</relativeTargetDir>
      </hudson.plugins.git.extensions.impl.RelativeTargetDirectory>
    </extensions>
  </scm>
  <canRoam>true</canRoam>
  <disabled>false</disabled>
  <blockBuildWhenDownstreamBuilding>false</blockBuildWhenDownstreamBuilding>
  <blockBuildWhenUpstreamBuilding>false</blockBuildWhenUpstreamBuilding>
  <triggers/>
  <concurrentBuild>false</concurrentBuild>
  <builders>
    <com.etas.jenkins.plugins.CreateTextFile.CreateFileBuilder plugin="text-file-operations@1.3.2">
      <textFilePath>nginx.conf</textFilePath>
      <textFileContent>user nginx;
worker_processes 4;
pid /run/nginx.pid;


events {
	worker_connections 768;
}

http {
	sendfile on;
	access_log /var/log/nginx/app.log;
	error_log /var/log/nginx/appe.log;
	include /etc/nginx/mime.types;

	

upstream phpfcgi {
     	server dtalk-php-svc:9000;

     }


  server {

        listen       80;
        server_name  admin.genie.lk;
		root /app/public/;
		error_log    /var/log/nginx/GenieAdminAppSvr1.error.log;
    	access_log   /var/log/nginx/GenieAdminAppSvr1.access.log;
        index index.php index.html index.htm; 
 
	location / {
        	try_files $uri $uri/ /index.php?$query_string;
                include       /etc/nginx/mime.types;
    	}

	location ~ \.php$ {
        	try_files $uri /index.php =404;
        	fastcgi_split_path_info ^(.+\.php)(/.+)$;
        	fastcgi_pass phpfcgi;
        	fastcgi_index index.php;
        	fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        	include fastcgi_params;
                include       /etc/nginx/mime.types;
    	}

       location ~ \.css {
    add_header  Content-Type    text/css;
}
location ~ \.js {
    add_header  Content-Type    application/x-javascript;
}

 	
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }


    }

	
	
}</textFileContent>
      <fileOption>overWrite</fileOption>
      <useWorkspace>true</useWorkspace>
    </com.etas.jenkins.plugins.CreateTextFile.CreateFileBuilder>
    <com.etas.jenkins.plugins.CreateTextFile.CreateFileBuilder plugin="text-file-operations@1.3.2">
      <textFilePath>Dockerfile</textFilePath>
      <textFileContent>FROM centos:7

RUN echo $&apos;[nginx] \n\
name=nginx repo \n\
baseurl=http://nginx.org/packages/centos/$releasever/$basearch/ \n\
gpgcheck=0 \n\
enabled=1&apos; &gt;&gt; /etc/yum.repos.d/nginx.repo  \
	&amp;&amp; yum update \
	&amp;&amp; yum install -y nginx
	
ADD nginx.conf /etc/nginx/nginx.conf
#ADD sites-enabled/ /etc/nginx/sites-enabled
	

# forward request and error logs to docker log collector
RUN ln -sf /dev/stdout /var/log/nginx/access.log \
	&amp;&amp; ln -sf /dev/stderr /var/log/nginx/error.log

ADD app/ /app

EXPOSE 80 443

CMD [&quot;nginx&quot;, &quot;-g&quot;, &quot;daemon off;&quot;]</textFileContent>
      <fileOption>overWrite</fileOption>
      <useWorkspace>true</useWorkspace>
    </com.etas.jenkins.plugins.CreateTextFile.CreateFileBuilder>
    <hudson.tasks.Shell>
      <command>sudo docker build -t dtnginx .
sudo docker tag dtnginx:latest 341025277667.dkr.ecr.eu-central-1.amazonaws.com/dtnginx:latest
sudo docker login -u AWS -p AQECAHh3zYOdtpBBSVw/Y2an8BXID4kwLQfnoTj5zwZtGJZoZQAABIgwggSEBgkqhkiG9w0BBwagggR1MIIEcQIBADCCBGoGCSqGSIb3DQEHATAeBglghkgBZQMEAS4wEQQMcshd+WaSVOYHMLPtAgEQgIIEOxf6BjeUxSc3s7oK60Oh7aAMC7ykGm7RcxYm4wMFQF+YtLkF56pTbhOILTMSS+vzqUtNL7DJ3vIwQBGzjMZ30a+frZ21vKsO/bocb1gnQLoFYGxfHrik8t4XKePVjSxScCKaW8iTXwwm4SmtuveZSNauvGd77dAWfOH5NzwjkHRVVryuz0Z+3BM08Ak/wv1ysdc4jpGwBCvaaFmHHkfLfOT/4scQNhmcRZw8YTfvvyoyHbzZijeN4L/kIy1sjBXroY0gKJaPZlylpk09Et9XWQ+QROWp0APezVHeLYlZshAJJOGB9xnD96Q7kp2ZlGN/nb/O7CFrgdM0z5ExVge0eaF4ylMVxJtuzrY2viM2jRYUh6B3JI9IHZyOGBlNleiWftNY8bF0yacsxLpkVcSk1cJUKGzzUf4w2TjYHa+r8l8kuaIDn+I3EFzuU9RVLRqpbnb7VCrK+n1enfFYkpzTc+Hewb8XXhVekp2UJLyfVEc1MvGpI/3jRReBaaz0Fb0ZL1Iqqqo0vqvUoctpVUidZ6YxY/Z0iw+vKNxZIujxxEshq9fAFw/cqlLTF0rMkbRKMmxfqRUWDsPardScVB0SRFzoKhzg0bCLuixhTqmpMqSjY6gQEEPNtS00kU5sRu28wxFU/4JBELGsCXUgqrHeFLnmPwTbulX1AaAFYf6dpgIXtrh+3WYRps07wptHhBi22ruloTpUptH32uzOffKnPG7fctIgCd6NEJlQFYTwhVbFXj8R8sJ7n+9F2BKW6xQEEZqil304Y1JrqrcWF/qQegoxSlAOO4P8c1OXriuxj6ejIcO9efFBPIvdKF4VYBYuIcMcvZdlFVZE09FTJBOUqkKiIZXYnEgcRU6mmMXDg2JgTXTCGftjLdw43Syu3atGsaqRMpHR+vS8IxiR/iuYGbxNb+rIGjk83oIXrTjNJqWg0RQA4qt6P+mc8DoFA+U/XvqRFXdh3JXGBXx7gMmHIIksVEIip3WkYpR/uhRtsWgpcXC8cz1l+m+bXCXzRn6djfdTmc/AvUngIqyZB/as+mdDBVw26Gaqh/m7EHwjxhqjPYZoo4egZT2OqOUCy/tT6rI/CDfvw1b0SwPIWJLgS8oD9nDD5iaj26l118TAw+SQ1Y4otfdbOxaw6N2mTMJe9k0obAg8PqsHuq4/H92RtIvqB7fulGT0LgM3Snr4MBarYxP1QG0OJ4+V0M6keUQ0KD96FgF36lgyjGScZEv54UgLld2WwU2MQF2XGG5KR5S/ljKAzogqWFlMd+dZZS0F0Hh3uwF+jURLP6GR80I7uhbJ9GGKHAQdxLf2YByonie7ySoAzQrsljac3LpTydtPx1tNTs26xOs/jgXJZ3O0v8eWb7ba9ZqCqJUVWvJC21bLV6MPX3VjZMt5xQqgJnEAC6nE1764JHZNn3RTWBx6V41+oz8mF3ZzeBJ2cw== -e none https://341025277667.dkr.ecr.eu-central-1.amazonaws.com
sudo docker push 341025277667.dkr.ecr.eu-central-1.amazonaws.com/dtnginx:latest</command>
    </hudson.tasks.Shell>
  </builders>
  <publishers/>
  <buildWrappers/>
</project>